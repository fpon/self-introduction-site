# プロジェクトルール

## ファイルの目的

このファイルは、Claude Codeが遵守すべきルール、ワークフロー、パターンを定めている。

---

## 厳守ワークフロー（毎回必須実行。以下の順番を厳守）

1. **行動プラン作成**: TodoWriteツールを使用して具体的な行動プランを作成（以下の厳守ワークフローの順番を必ず守ること）
2. **ブランチ確認・移動**:
   - 現在のブランチがdevelopブランチの場合: 新しいfeatureブランチを作成して移動
   - 現在のブランチがdevelopブランチではない場合: developブランチとの差分をチェックし、やろうとしていることの理解をする
3. **最新のやり方を調査**: 実装する機能に関する最新のベストプラクティスやライブラリの使用方法をWebSearchツールで調査
   - 公式ドキュメントを優先的に参照
   - 最新バージョンの情報を確認
4. **ゴールに向けて行動**: 各作業ステップでゴール達成に繋がる改善を積極的に実施
5. **lint実行**:
     - `cd client && bun run fix`
     - `cd client && bun run typecheck`
6. **5原則リファクタリング**: DRY・YAGNI・KISS・SOLID・可読性保守性の順で改善
7. **ゴミ掃除の徹底**: 作業完了後の不要ファイル・コードの削除
   - 作業中に作成した一時ファイルやテストファイルの削除
   - 不要になったimport文の削除
   - 使用されていないコード・変数・関数の削除
   - 空のディレクトリの削除
   - デバッグ用のconsole.logやprint文の削除（問題解決後は必ず削除）
   - 作成したが使用しなかったファイルの削除
   - 重複コードの削除とリファクタリング
   - **importされているが使用されていないファイルの調査と削除**
     - Grepツールでファイルがどこからもimportされていないかをチェック
     - 特にutil関数、helper関数、カスタムフックの使用状況を確認
     - 不要と判断したファイルは削除
   - **使用されていないコンポーネントの調査と削除**
     - atoms、molecules、organisms、substances、serversの各層で未使用コンポーネントを検出
     - 対応するStorybookファイルも合わせて削除
     - 型定義ファイルやテストファイルも合わせて削除
8. **lint再実行**: ステップ6の内容を再実行
   - エラー発生時は修正して対応
9. **ゴール達成確認**: 作業の最後にゴールを達成したかを確認すること
    - 達成できないどうしてもな理由がある場合は、理由を最後にまとめること（内容は端的にまとめること）
    - 作成したテストが保守に不要であれば削除
    - テスト実行は後のlint実行ステップで一括実行
10. **commit + push実行とPR作成**: 自動実行（ユーザー確認不要）し、PR作成後`open [PR_URL]`でブラウザでPRを開く

---

## TodoWrite管理ルール（超重要）

### 依頼追加時の必須対応

- **途中依頼の発生時**: ユーザーから作業途中で新しい依頼や指示が追加された場合、**必ずTodoWriteを再構築**する
- **理由**: 
  - ユーザーが無視されたと感じることを防ぐ
  - タスクの優先順位や順序を正しく管理する
  - 作業の抜け漏れを防ぐ
  - 自分自身も忘れる可能性があるため
- **実施方法**:
  1. 現在のTodoリストに新しい依頼を追加
  2. 優先順位を再評価
  3. 必要に応じて既存タスクの順序を調整
  4. TodoWriteツールで更新を実行
- **例外なし**: どんなに小さな追加依頼でも必ずTodoに追加する

---

## 思考・検証ルール（厳守）

### 推測・脳死回答の禁止

- **脳死同意禁止**: ユーザーの提案に対して「その通りです！」「正解です！」などの即座の同意は厳禁
- **推測回答禁止**: 「〜だと思います」「〜のはずです」等の推測による回答は厳禁。不明な点は必ずWebSearchツールで調査、または実際にテスト実行して確認
- **根拠なし発言禁止**: 全ての発言に実証的根拠を必須とする

### 必須検証プロセス

- **批判的思考必須**: ユーザーの提案に対しても「本当にそうか？」を常に自問
- **段階的検証**: 複数の仮説がある場合は、一つずつ切り分けて検証
- **根本原因の特定**: 問題発生時は表面的な修正を繰り返さず、デバッグを段階的に行い原因を特定してから修正

### 検証手順テンプレート

1. **現状確認**: 実際の動作・設定を確認（推測せず必ず実行）
2. **仮説設定**: 変更による影響を予測（複数パターン検討）
3. **実証テスト**: 実際に変更して動作確認
4. **反証テスト**: 逆パターン・エラーケースでの確認
5. **結論**: 根拠と共に回答（推測部分の明確化）

---

## 開発原則

### コード設計原則

#### 5大原則（必須）
- **YAGNI**: 必要になるまで機能を追加しない
- **DRY**: 重複コードは避け、共通化を図る
- **KISS**: シンプルな実装を心がける
- **SOLID**: 単一責任の原則に従う
- **可読性・保守性**: 誰でも理解できるコードを最優先

#### 開発手法
- **既存コード踏襲**: 類似機能の既存コードを参照して同じパターンで実装
- **一貫性の優先**: 新しいアプローチより既存コードとの整合性を最優先する
- **段階的な確認**: 大きな変更時は途中でproject_checkを実行して早期にエラーを発見
- **early returnのワンライナー化**: `if (!condition) return value`のような単純なearly returnは1行で書く
- **環境設定のデフォルト値禁止**: 環境変数や設定値にデフォルト値を設定することは禁止。デフォルト値はエラーを隠蔽し、設定ミスを見逃す原因となる
- **依頼への専念**: ユーザーの依頼に専念し、その依頼以外のイレギュラーが起きたらチケット化する

### 技術導入の意思決定プロセス

#### 必須ステップ
1. **現状分析**：既存コードの品質・保守性評価
2. **問題特定**：解決すべき具体的な課題明確化
3. **代替案比較**：既存パターン改善 vs 新技術導入
4. **コスト分析**：学習コスト、移行コスト、保守コスト
5. **チーム合意**：理解しやすさ、メンテナンス性重視

### Client (bun) 実行環境

- **原則**: Clientは常にlocal環境で実行する
- **実行方法**:
  - ✅ Local実行: `(cd client && bun run dev)`

### WebSearch実行ルール

- **WebSearch実行ルール**: 検索精度向上のため、WebSearchツールは英語で実行する
  - 検索時は現在時刻を調べてその年度を利用して最新情報を取得する
- **最新情報優先**: 古い情報はノイズなので、最新の情報を重視して使用する
- **公式情報優先**: 公式ページが最も新しく正確な可能性が高いため、公式情報を優先的に参照する

### 固定値管理

- **constants.tsで一元管理**: プロジェクト全体で使用する固定値は`src/constants.ts`で管理
- **マジックナンバー禁止**: ハードコーディングされた数値・文字列は定数化必須

---

## 運用ルール

### Git・PR運用ルール

- **ブランチ名**: 英語で作成（例: `feature/add-authentication`、`fix/user-login-error`）
- **PRの言語**: タイトル・本文は日本語、コミットメッセージは英語
- **PRテンプレート**: .github/pull_request_template.mdのテンプレートに沿って記載すること。特に記載がない場合は空欄で良い。
- **PRのAssignees**: PRを作成したUserをアサインする
- **環境設定**: `.env.sample`はコミット可能
- **.env.sample修正時の必須対応**: `.env.sample`を修正した場合は、必ず環境変数を更新する

### 厳禁事項

- TODOコメント以外のコメント禁止（# type: ignore等のignoreコメントは許可）
- 略語使用禁止（完全な形で記載）
- 相対パス使用禁止: 全てのパス指定は絶対パスを使用する
- **ポートベタ書き禁止**: 全てのポート指定は環境変数を使用し、ハードコーディング禁止
- **認証情報の変更厳禁**: 以下の環境変数は絶対に値を変更しない（キー名の変更は可）
  - API KEY、SECRET、TOKEN類
  - これらの値は**ユーザーの実際の認証情報**のため、変更は重大なセキュリティ問題を引き起こす
- **保護ディレクトリの変更禁止**: 設定で保護されているディレクトリは絶対に変更・編集・削除禁止

---